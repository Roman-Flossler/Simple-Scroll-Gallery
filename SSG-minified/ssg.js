
// Simple Scroll Gallery (SSG)
// Copyright (C) 2018 Roman FlÃ¶ssler - flor@flor.cz
//
// licensed under Mozilla Public License 2.0 with one exception: it is not granted to develop a Wordpress plugin based on SSG.
// Here you can see how gallery works - http://ssg.flor.cz/
// SSG on Github: https://github.com/Roman-Flossler/Simple-Scroll-Gallery.git

var SSG={jQueryImgSelector:"a[href$='.jpg'],a[href$='.jpeg'],a[href$='.JPG'],a[href$='.png'],a[href$='.PNG'],a[href$='.gif'],a[href$='.GIF']",setVariables:function(){SSG.fileToLoad="ssg-loaded.html",SSG.imgs=[],SSG.loaded=-1,SSG.displayed=-1,SSG.originalPos=window.pageYOffset||document.documentElement.scrollTop,SSG.scrHeight=jQuery(window).height(),jQuery(window).width()/SSG.scrHeight>=1?SSG.scrFraction=2:SSG.scrFraction=3.5,SSG.imageDown=!1,SSG.imageUp=!1,SSG.firstImageCentered=!1,SSG.scrollingAllowed=!0,SSG.fullscreenMode=!1,SSG.fullscreenModeWanted=!1,SSG.exitFullscreen=!1,SSG.finito=!1,SSG.lastone=!1,SSG.exitClicked=!1,SSG.firstTick=!0,SSG.standardMode=!0},initGallery:function(e){e&&e.noExit&&(SSG.standardMode=!1),jQuery(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",SSG.onFS),window.scrollTo(0,0),jQuery("body").append("<div id='SSG_galBg'></div><div id='SSG_gallery'></div>"),SSG.standardMode&&jQuery("body").append("<div id='SSG_exit'></div>"),jQuery("html").addClass("ssg"),e&&e.currentTarget&&("DT"==e.currentTarget.parentNode.tagName||"fs"==e.currentTarget.parentElement.classList[0]||"fs"==e.currentTarget.classList[0])&&SSG.openFullscreen(),e&&e.fs&&(SSG.openFullscreen(),SSG.fullscreenModeWanted=!0),jQuery(document).keydown(SSG.keyFunction),jQuery("#SSG_exit").click(function(){SSG.exitClicked=!0,SSG.destroyGallery()}),jQuery("#SSG_gallery").click(SSG.touchScroll),jQuery("body").on("mousewheel DOMMouseScroll",SSG.revealScrolling)},keyFunction:function(e){27==e.which&&SSG.standardMode&&SSG.destroyGallery(),40!=e.which&&39!=e.which&&34!=e.which&&32!=e.which||(SSG.imageDown=!0),38!=e.which&&37!=e.which&&33!=e.which||(SSG.imageUp=!0),e.preventDefault()},touchScroll:function(e){e.clientY<SSG.scrHeight/2?SSG.imageUp=!0:SSG.imageDown=!0},getHrefAlt:function(e){return e.children[0]&&e.children[0].alt?{href:e.href,alt:e.children[0].alt}:e.innerText?{href:e.href,alt:e.innerText}:{href:e.href,alt:""}},getImgList:function(e){if(Array.prototype.forEach.call(jQuery(SSG.jQueryImgSelector).toArray(),function(e){SSG.imgs.push(SSG.getHrefAlt(e))}),e&&e.currentTarget)var S=SSG.getHrefAlt(e.currentTarget),r=S.href,n=S.alt;else if(e&&e.img)r=e.img.href,n=e.img.alt;if(r&&SSG.imgs.length>1){for(var i=SSG.imgs.length>=6?5:SSG.imgs.length,o=0;o<i;o++)if(SSG.imgs[o].href==r){SSG.imgs.splice(o,1);break}SSG.imgs.unshift({href:r,alt:n})}},onFS:function(){SSG.fullscreenMode&&SSG.exitFullscreen&&!SSG.exitClicked&&(SSG.standardMode&&SSG.destroyGallery(),SSG.fullscreenMode=!1),SSG.exitFullscreen||(SSG.exitFullscreen=!0,SSG.fullscreenMode=!0)},refreshPos:function(){for(var e=0;e<=SSG.loaded;e++)SSG.imgs[e].pos=Math.round(jQuery("#i"+e).offset().top)},countResize:function(){SSG.scrHeight=jQuery(window).height(),jQuery(window).width()/SSG.scrHeight>=1?SSG.scrFraction=2:SSG.scrFraction=3.5,SSG.firstImageCentered&&SSG.refreshPos()},addImage:function(){var e=SSG.loaded+1;if(e<SSG.imgs.length&&(jQuery("#SSG_gallery").append("<div class='SSG_imgWrap'><span class='SSG_forlogo'><img id='i"+e+"' src='"+SSG.imgs[e].href+"'><span class='SSG_logo'></span></span></div>"),SSG.imgs[e].alt||(SSG.imgs[e].alt=""),jQuery("#SSG_gallery").append("<p id='p"+e+"'>"+SSG.imgs[e].alt+"</p>"),jQuery("#i"+e).on("load",function(e){SSG.refreshPos()}),SSG.loaded=e),e==SSG.imgs.length){var S;S=SSG.standardMode?"<a id='SSG_exit2' class='SSG_link'>&times; Exit the Gallery</a>":"";jQuery("#SSG_gallery").append("<div id='SSG_lastone'> <p id='SSG_menu'><a id='SSG_first' class='SSG_link'><span>&nbsp;</span> Scroll to top</a>"+S+"<a id='SSGL' target='_blank' href='http://ssg.flor.cz/' class='SSG_link'>&#9910; SSG</a></p> <div id='SSG_loadInto'></div></div>"),jQuery("#SSG_menu").click(function(e){e.stopPropagation()}),jQuery("#SSG_exit2").click(function(){SSG.exitClicked=!0,SSG.destroyGallery()}),jQuery("#SSG_first").click(function(){SSG.firstImageCentered=!1}),SSG.fileToLoad&&jQuery("#SSG_loadInto").load(SSG.fileToLoad,function(){jQuery(".SSG_icell").click(function(e){e.stopPropagation()})}),SSG.finito=!0}0==e&&(jQuery("#p0").append('<a id="SSG_tipCall">more photos</a>'),jQuery("#SSG_tipCall").click(function(e){SSG.showFsTip(!1),e.stopPropagation()}))},getName:function(e){return e.slice(e.lastIndexOf("/")+1)},metronome:function(){var e=window.pageYOffset||document.documentElement.scrollTop;SSG.imgs[SSG.loaded].pos&&!SSG.finito&&(SSG.imgs[SSG.loaded].pos-e<3*SSG.scrHeight&&SSG.addImage());SSG.loaded>0&&SSG.imgs[SSG.loaded-1].pos-e<.5*SSG.scrHeight&&!SSG.finito||!SSG.imgs[0].pos?jQuery(document.body).addClass("wait"):jQuery(document.body).removeClass("wait"),e+=Math.round(SSG.scrHeight/SSG.scrFraction),SSG.onEachSecondTick=!SSG.onEachSecondTick,SSG.onEachSecondTick&&(SSG.afterScroll=!1);for(var S=0;S<=SSG.loaded;S++){var r=0;r=S<SSG.imgs.length-1?SSG.imgs[S+1].pos:SSG.imgs[S].pos+SSG.scrHeight,e>SSG.imgs[S].pos&&e<r&&("undefined"!=typeof ga&&SSG.displayed!=S&&ga("send","pageview","/img"+location.pathname+SSG.getName(SSG.imgs[S].href)),SSG.displayed=S)}SSG.firstTick&&(!SSG.fullscreenMode&&SSG.fullscreenModeWanted&&SSG.showFsTip(!0),SSG.firstTick=!1),SSG.jumpScroll()},jumpScroll:function(){SSG.imageUp&&SSG.displayed-1>=0&&!SSG.lastone&&jQuery("html, body").animate({scrollTop:SSG.imgs[SSG.displayed-1].pos-SSG.countImageIndent(SSG.displayed-1)},500,"swing"),SSG.imageUp&&SSG.lastone&&(jQuery("html, body").animate({scrollTop:SSG.imgs[SSG.displayed].pos-SSG.countImageIndent(SSG.displayed)},500,"swing"),SSG.lastone=!1),SSG.displayed+1<SSG.imgs.length&&SSG.imageDown&&SSG.imgs[SSG.displayed+1].pos?jQuery("html, body").animate({scrollTop:SSG.imgs[SSG.displayed+1].pos-SSG.countImageIndent(SSG.displayed+1)},500,"swing"):void 0!==jQuery("#SSG_menu").offset()&&SSG.imageDown&&jQuery("html, body").animate({scrollTop:jQuery("#SSG_menu").offset().top-SSG.scrHeight/10},500,"swing",function(){SSG.lastone=!0}),SSG.imgs[0].pos&&!SSG.firstImageCentered&&(jQuery("html, body").animate({scrollTop:SSG.imgs[0].pos-SSG.countImageIndent(0)},200,"swing"),SSG.firstImageCentered=!0,SSG.countResize()),SSG.imageDown=!1,SSG.imageUp=!1},countImageIndent:function(e){var S=jQuery(window).height(),r=jQuery("#i"+e).outerHeight(!0),n=jQuery("#p"+e).innerHeight(),i=jQuery("#p"+e).outerHeight(!0)-n,o=Math.round((S-(r+n))/2);return o<0&&(o*=2),o>i?i:o},seizeScrolling:function(e){function S(){jQuery(window).bind("mousewheel DOMMouseScroll",SSG.preventDef),SSG.scrollTimeout=setTimeout(SSG.setScrollActive,482),e=0,SSG.scrollingAllowed=!1}1==e&&SSG.scrollingAllowed?(S(),SSG.afterScroll||(SSG.imageDown=!0)):-1==e&&SSG.scrollingAllowed&&(S(),SSG.afterScroll||(SSG.imageUp=!0))},preventDef:function(e){e.preventDefault()},setScrollActive:function(){SSG.scrollingAllowed=!0,SSG.afterScroll=!0,clearTimeout(SSG.scrollTimeout),jQuery(window).off("mousewheel DOMMouseScroll",SSG.preventDef)},revealScrolling:function(e){"number"==typeof e.originalEvent.detail&&0!==e.originalEvent.detail?e.originalEvent.detail>0?SSG.seizeScrolling(1):e.originalEvent.detail<0&&SSG.seizeScrolling(-1):"number"==typeof e.originalEvent.wheelDelta&&(e.originalEvent.wheelDelta<0?SSG.seizeScrolling(1):e.originalEvent.wheelDelta>0&&SSG.seizeScrolling(-1))},openFullscreen:function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},closeFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},destroyGallery:function(){clearInterval(SSG.metronomInterval),"undefined"!=typeof ga&&ga("send","pageview",location.pathname),jQuery("#SSG_galBg,#SSG_gallery,#SSG_exit,#SSG_lastone,#SSG_tip").remove(),jQuery("html").removeClass("ssg"),jQuery("body").off("mousewheel DOMMouseScroll",SSG.revealScrolling),jQuery(window).off("resize",SSG.countResize),jQuery(document).off("keydown",SSG.keyFunction),jQuery(document).off("webkitfullscreenchange mozfullscreenchange fullscreenchange",SSG.onFS),SSG.fullscreenMode&&SSG.closeFullscreen(),SSG.fullscreenMode?window.setTimeout(function(){window.scrollTo(0,SSG.originalPos)},100):window.scrollTo(0,SSG.originalPos),SSG.running=!1},showFsTip:function(e){if(0==jQuery("#SSG_tip").length){var S="<div id='SSG_tip'><span><div id='SSG_tipClose'>&times;</div>",r="Browse through the gallery by:<br/>a mouse wheel <strong>&circledcirc;</strong> or arrow keys <strong>&darr;&rarr;&uarr;&larr;</strong><br/>",n="or <strong>TAP</strong> on the bottom (top) of the screen<br/>",i="For a better experience <br/><a>click for fullscreen mode</a><br/>",o="</span></div>";e?jQuery("body").append(S+i+o):SSG.fullscreenMode?jQuery("body").append(S+r+n+o):jQuery("body").append(S+r+n+"<hr/>"+i+o),!SSG.fullscreenMode&&jQuery("#SSG_tip").click(function(){SSG.openFullscreen(),jQuery("#SSG_tip").remove(),SSG.firstImageCentered=!1}),jQuery("#SSG_tipClose").click(function(){jQuery("#SSG_tip").remove()})}else jQuery("#SSG_tip").remove()},getHash:function(e){var S=window.location.hash;if(""!=S){S=S.substring(1,S.length);var r=jQuery("a[href*='"+S+"'][href$='.jpg'],a[href*='"+S+"'][href$='.JPG'],a[href*='"+S+"'][href$='.jpeg'],a[href*='"+S+"'][href$='.png'],a[href*='"+S+"'][href$='.gif']").toArray();if(r[0]){var n=SSG.getHrefAlt(r[0]);if(e)return{href:n.href,alt:n.alt};SSG.run({fs:!0,img:{href:n.href,alt:n.alt}})}}return null},run:function(e){return!SSG.running&&(SSG.running=!0,e||(e={}),e&&!e.img&&SSG.getHash(!0)&&(e.img=SSG.getHash(!0)),SSG.setVariables(),SSG.initGallery(e),SSG.getImgList(e),SSG.addImage(),SSG.metronomInterval=setInterval(SSG.metronome,333),jQuery(window).resize(SSG.countResize),!1)}};jQuery(document).ready(function(){jQuery(SSG.jQueryImgSelector).click(SSG.run)}),jQuery(document).ready(function(){window.setTimeout(SSG.getHash(!1),10)});